<!DOCTYPE html>
<html lang="fr-FR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AREP DIFFUSION</title>

    <!-- Add the link to the SCSS style sheet -->
    <link rel="stylesheet" href="styles.css">

    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-VFMgtYsbkEX9PC0Q/3M3N15zkNxdMKvyB11EyuAVv3xj3tx8e7LKX6yKU4sjo8PVnrDUEBy9QaQZayQEXbbKGg==" crossorigin="anonymous" />

    <!-- React CDN links -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <!-- Babel for JSX/React -->
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- DATA -->
    <!-- <script src="./data/bordeaux_iso_20min.js"></script> -->
    <script src="./data/bordeaux_iso_15min.js"></script>
    <!-- <script src="./data/bordeaux_iso_10min.js"></script> -->
    <script src="./data/lyon_iso_15min.js"></script>
    <script src="./data/marseille_iso_15min.js"></script>
    <script src="./data/nantes_iso_15min.js"></script>
    <script src="./data/strasbourg_iso_15min.js"></script>

    <script src="./data/data_geojson.js"></script>

    <!-- COMPONENTS -->
    <script type="text/babel">

    // Navigation.js
    const Navigation = () => {
        return (
            <nav>
                <div className="logo">
                    <img src="img/logo_arep.png" alt="AREP" />
                </div>
                <ul className="menu">
                    <li><a href="">ACCUEIL</a></li>
                    <li><a href="#">EQUIPE</a></li>
                    <li><a href="#">RESSOURCES</a></li>
                </ul>
            </nav>
        );
    }

    //LEAFLET
    const LeafletMap = (props) => {
        React.useEffect(() => {
            // Create a Leaflet map centered at [0, 0] with zoom level 2
            const map = L.map('map', { minZoom: 5 });

            // Add a tile layer using CDN links
            L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png?&api_key=a31200ab-bc94-4e77-b6d9-87fb29b52314').addTo(map);

            //GEOJSON FROM DATA
            // const selected_gare = "bordeaux";
            list_of_gares[props.selected_gare].forEach(iso => {
                L.geoJSON(iso.feature, { 
                    style: iso.style
                }).addTo(map);
            });

            map.fitBounds(L.geoJSON((list_of_gares[props.selected_gare][0].feature)).getBounds());
            map.setZoom(11);

            return () => {
                // Clean up the map when the component is unmounted
                map.remove();
            };
        }, [props.selected_gare]); // Empty dependency array ensures this effect runs once when the component mounts
        
        return (
            <div className='LeafletMap'>
                <div className="LeafletMap-arrow"> 	&#x3008; </div>
                <div id="map" style={{ height: '500px', width: '500px', borderRadius: '50%', margin:'0 auto' }}></div>
                <div className="LeafletMap-arrow"> 	&#x3009; </div>
            </div>
        );
    }

    //SEARCH
    const SearchBar = ({ onSearch }) => {
        const [query, setQuery] = React.useState('');

        const handleInputChange = (e) => {
            setQuery(e.target.value);
            if(e.target.value.length > 2) onSearch(query);
        };

        const handleSearch = () => {
            // Pass the search query to the parent component
            // onSearch(query);
        };

        return (
            <div className="search-bar">
                <input
                    type="text"
                    placeholder="Trouver une gare..."
                    value={query}
                    onChange={handleInputChange}
                />
                {/*<button onClick={handleSearch}>Search</button>*/}
            </div>
        );
    };
    
    //LIST OF ELEMENT IN LINE
    const InlineList = (props) => {
        
        const send_uic = (key) => {
            // console.log("ðŸš€ ~ getGare ~ code", code)
            props.handleGetGare(key);
        };

        return (
            <div className="inline-list">
                {props.items.map((item, index) => (
                    <div key={index} className="list-item">
                        {/*item*/}
                        <ElementWithImageAndText
                            key={index}
                            imageUrl={item.imageUrl}
                            selected={item.selected}
                            code={item.code}
                            text={item.text}
                            keyword={item.keyword}
                            handleListClick={send_uic}
                        />
                    </div>
                ))}
            </div>
        );
    }

    //ELEMENT
    const ElementWithImageAndText = (props) => {
        var selected = props.selected ? 'element-with-image-and-text selected' : 'element-with-image-and-text ';

        const ElementClick = () => {
            props.handleListClick(props.keyword);

        };
        
        return (
            <div className={selected}  onClick={ElementClick}>
                <img src={props.imageUrl} alt="Element Image" className="element-image" />
                <p className="element-text"> UIC:{props.code} <br/> {props.text}</p>
            </div>
        );
    }

    </script>

    <!-- Your React components will be placed in the following script tag -->
    <script type="text/babel">

        const App = () => {
            const [selection, setSelection] = React.useState('lyon');

            const items_1 = [];
            Object.keys(list_of_gares).forEach(function(key) {
                items_1.push({
                    selected: selection == key,
                    imageUrl: "./img/"+key+".png", 
                    code: list_of_gares[key][0].code_uic,
                    text: list_of_gares[key][0].name,
                    keyword:key,
                });
            });

            const [items, setItems] = React.useState(items_1);

            React.useEffect(() => {
                // console.log('selection is now: ', selection);

            }, [selection, items]);

            const get_key = (key) => { 
                setSelection(key);
                setItems(items.map( e => e.keyword === key ? {...e, selected: true} : {...e, selected: false}));
            };

            const handleSearch = (query) => {
                // Handle the search logic here (e.g., fetch data, filter results)
                console.log('Search Query:', query);
            };
            
            return (
                <div id='main'>
                    <Navigation />
                    <LeafletMap selected_gare = {selection} />
                    <SearchBar onSearch={handleSearch} />
                    <InlineList handleGetGare={get_key} items={items} />
                </div>
            );
        }

        // Render the React component
        ReactDOM.render(
            <App />,
            document.getElementById('root')
        );
    </script>
</head>
<body>

    <!-- The root div where React will be mounted -->
    <div id="root"></div>

</body>
</html>
